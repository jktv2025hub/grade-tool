<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤¯ ë³µì¡í•œ ë“±ê¸‰ê³„ì‚°, ì´ê±¸ë¡œ ë! (ìš°ë¦¬ë°˜ ë“±ê¸‰ ê³„ì‚°ê¸°)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f4f8; /* ë°ê³  ë¶€ë“œëŸ¬ìš´ ë°°ê²½ìƒ‰ */
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column; /* í‘¸í„° ë°°ì¹˜ë¥¼ ìœ„í•´ columnìœ¼ë¡œ ë³€ê²½ */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 700px;
            margin: 20px;
        }

        /* --- 1. ì œëª© --- */
        header {
            background: linear-gradient(135deg, #3498db, #5dade2); /* ë°ì€ ê·¸ë¼ë°ì´ì…˜ */
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.3);
            position: relative; 
            overflow: hidden; 
        }

        /* [ìˆ˜ì •] í…ìŠ¤íŠ¸ ê·¸ë¼ë°ì´ì…˜ ì œê±° */
        header h1 {
            margin: 0;
            font-size: 2.2rem; /* í¼ì§í•œ ì œëª© */
            font-weight: 700;
            color: white; /* í…ìŠ¤íŠ¸ ê·¸ë¼ë°ì´ì…˜ ì œê±°, í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); /* ê·¸ë¦¼ì ë‹¨ìˆœí™” */
        }

        /* ì œì‘ì ì„œëª… ìŠ¤íƒ€ì¼ (ì´ì „ ë²„ì „ ìœ ì§€) */
        .author-credit {
            display: inline-block; 
            margin: 15px 0 0 0; 
            padding: 5px 15px; 
            font-size: 0.9rem; 
            font-weight: 500; 
            color: #ecf0f1; 
            background-color: rgba(0, 0, 0, 0.15); 
            border-radius: 20px; 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); 
        }

        /* --- 2 & 3. ì…ë ¥ ì„¹ì…˜ --- */
        .input-section {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-top: 25px;
        }

        /* ì…ë ¥ ì„¹ì…˜ ë‚´ë¶€ì˜ ê°œë³„ ë°•ìŠ¤ */
        .calc-mode-box {
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f4f8; /* Light separator line */
        }
        .calc-mode-box:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .input-section h2 {
            margin-top: 0;
            color: #2c3e50;
            font-weight: 700;
        }

        /* ê¸°ëŠ¥ ì„¤ëª… í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .description {
            font-size: 0.95rem;
            color: #555;
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 6px;
            margin-top: 0;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .radio-group {
            margin-bottom: 20px;
        }

        .radio-group label {
            font-size: 1.1rem;
            font-weight: 500;
            margin-right: 20px;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            margin-right: 5px;
            accent-color: #3498db; /* ë¼ë””ì˜¤ ë²„íŠ¼ ìƒ‰ìƒ */
        }

        /* 2ì—´ ì…ë ¥ ê·¸ë£¹ (ë‚´ ë“±ê¸‰) */
        .input-group {
            margin-bottom: 20px;
            display: flex; /* ê°€ë¡œ ë°°ì¹˜ë¥¼ ìœ„í•´ flex ì‚¬ìš© */
            gap: 15px;
        }
        
        .input-group > div {
            flex: 1; /* 1:1 ë¹„ìœ¨ë¡œ ë‚˜ëˆ” */
        }
        
        /* 1ì—´ ì…ë ¥ ê·¸ë£¹ (ì „ì²´ ì¸ì›) */
        .input-group-single {
             margin-bottom: 20px;
        }

        .input-group label,
        .input-group-single label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        .input-group input[type="number"],
        .input-group-single input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box; /* íŒ¨ë”© í¬í•¨ */
            font-size: 1.1rem;
            transition: border-color 0.3s ease;
        }
        
        .input-group input[type="number"]:focus,
        .input-group-single input[type="number"]:focus {
            border-color: #3498db;
            outline: none;
        }

        button#calculate-btn {
            width: 100%;
            padding: 15px;
            background-color: #e67e22; /* ëˆˆì— ë„ëŠ” ì£¼í™©ìƒ‰ ë²„íŠ¼ */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: 700;
            transition: all 0.3s ease;
            margin-top: 20px; /* ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
        }

        button#calculate-btn:hover {
            background-color: #d35400;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(230, 126, 34, 0.3);
        }

        /* --- ê²°ê³¼ ì„¹ì…˜ (ì°¨íŠ¸ + í…Œì´ë¸”) --- */
        .results-section {
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-top: 25px;
        }

        .chart-container {
            width: 100%;
            max-height: 350px;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        table th, table td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: center;
        }

        table th {
            background-color: #f9f9f9;
            font-weight: 700;
            color: #34495e;
        }
        
        table tr:nth-child(2) {
             background-color: #ebf5fb;
             font-weight: 500;
        }

        /* --- í´ë¦½ë³´ë“œ ë³µì‚¬ ë²„íŠ¼ --- */
        button#copy-btn {
            display: none; /* ì´ˆê¸° ìˆ¨ê¹€ */
            width: 100%;
            padding: 12px;
            background-color: #27ae60; /* ë…¹ìƒ‰ ê³„ì—´ */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 25px;
        }
        button#copy-btn:hover {
            background-color: #229954;
        }

        /* --- ë‚´ ë“±ê¸‰ ë¶„ì„ ì„¹ì…˜ --- */
        .my-grade-section {
            display: none; /* ì´ˆê¸° ìˆ¨ê¹€ */
            background: linear-gradient(135deg, #e67e22, #f39c12); /* ì£¼í™©ìƒ‰ ê³„ì—´ ê·¸ë¼ë°ì´ì…˜ */
            color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(230, 126, 34, 0.3);
            margin-top: 25px;
            text-align: center;
        }

        .my-grade-section h2 {
            margin-top: 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .my-grade-result p {
            font-size: 1.2rem;
            margin: 0;
            opacity: 0.9;
        }

        .my-grade-result strong {
            font-size: 3rem;
            font-weight: 700;
            display: block;
            margin: 5px 0 20px 0;
        }

        .my-grade-analysis {
            font-size: 1.1rem;
            line-height: 1.7;
            background-color: rgba(0, 0, 0, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: left; /* ë¶„ì„ ë‚´ìš©ì€ ì¢Œì¸¡ ì •ë ¬ */
        }
        
        .my-grade-analysis p {
            margin: 8px 0;
        }
        .my-grade-analysis strong {
             color: #fff;
             font-weight: 700;
        }

        /* --- ë™ì„ì°¨ ì„¤ëª… ì„¹ì…˜ --- */
        .info-section {
            background-color: #fff8e1; /* ì—°í•œ ë…¸ë€ìƒ‰ (íŒ/ë…¸íŠ¸) */
            border-left: 5px solid #f1c40f;
            padding: 20px;
            margin-top: 25px;
            border-radius: 8px;
        }
        
        .info-section h2 {
            margin-top: 0;
            color: #c29d0b;
        }
        
        .info-section p {
            line-height: 1.7;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>

    <div class="container">
        
        <header>
            <h1>ğŸ¤¯ ë³µì¡í•œ ë“±ê¸‰ê³„ì‚°, ì´ê±¸ë¡œ ë!</h1>
            <p class="author-credit">@ì œì‘ì: LeeJaeKyun 2025.10.29.</p>
        </header>

        <main>
            <section class="input-section">
                
                <div class="calc-mode-box">
                    <h2>ğŸ“Š ì „ì²´ ë“±ê¸‰ ë¶„í¬ ê³„ì‚°(*ì…ë ¥í•„ìˆ˜)</h2>
                    <p class="description">
                        ë“±ê¸‰ì œì™€ ì „ì²´ ì¸ì›ì„ ì…ë ¥í•˜ë©´, ë“±ê¸‰ë³„ ë¹„ìœ¨ê³¼ ì¸ì›ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
                    </p>

                    <div class="radio-group">
                        <input type="radio" id="grade-type-5" name="grade-type" value="5" checked>
                        <label for="grade-type-5">5ë“±ê¸‰ì œ (ë‚´ì‹ )</label>
                        <input type="radio" id="grade-type-9" name="grade-type" value="9">
                        <label for="grade-type-9">9ë“±ê¸‰ì œ (ìˆ˜ëŠ¥)</label>
                    </div>

                    <div class="input-group-single"> <label for="total-students">ì „ì²´ ì¸ì› (ëª…)</label>
                        <input type="number" id="total-students" placeholder="ì˜ˆ: 250">
                    </div>
                </div>

                <div class="calc-mode-box">
                    <h2>â­ ë‚´ ë“±ê¸‰ ìƒì„¸ ë¶„ì„ (*ì…ë ¥ì„ íƒ)</h2>
                    <p class="description">
                        ë³¸ì¸ ë“±ìˆ˜ë¥¼ í•¨ê»˜ ì…ë ¥í•˜ë©´, ë‚´ ë“±ê¸‰ê³¼ ìƒ/í•˜ìœ„ ë“±ê¸‰ì„ ë¹„êµ ë¶„ì„í•©ë‹ˆë‹¤.
                    </p>

                    <div class="input-group"> <div>
                            <label for="my-rank">ë³¸ì¸ ë“±ìˆ˜ (ë™ì„ì°¨ ì¤‘ ìµœê³  ë“±ìˆ˜)</label>
                            <input type="number" id="my-rank" placeholder="ì˜ˆ: 25">
                        </div>
                        <div>
                            <label for="my-ties">ë™ì„ì°¨ ì¸ì› (ë³¸ì¸ í¬í•¨)</label>
                            <input type="number" id="my-ties" placeholder="1" value="1">
                        </div>
                    </div>
                </div>
                
                <button id="calculate-btn">ê³„ì‚°í•˜ê¸°</button>
            </section>

            <section class="my-grade-section" id="my-grade-section">
                <h2 id="my-grade-title">â­ ë‚˜ì˜ ë“±ê¸‰ ë¶„ì„</h2>
                <div class="my-grade-result">
                    <p>ë‹¹ì‹ ì˜ ë“±ê¸‰ì€...</p>
                    <strong id="my-grade-display">?ë“±ê¸‰</strong>
                </div>
                <div class="my-grade-analysis" id="my-grade-analysis">
                    </div>
            </section>

            <section class="results-section" id="results-section">
                <h2 id="results-title">ğŸ“Š ì „ì²´ ë“±ê¸‰ ë¶„í¬</h2>
                
                <div class="chart-container">
                    <canvas id="gradeChart"></canvas>
                </div>

                <div id="grade-table-container"></div>

                <button id="copy-btn">ğŸ“‹ ì „ì²´ ë¶„í¬ ë³µì‚¬í•˜ê¸° (êµ¬ê¸€ ì‹œíŠ¸ìš©)</button>
            </section>

            <section class="info-section">
                <h2>ğŸ’¡ ë™ì„ì°¨(Ties) ì²˜ë¦¬ ê·œì •ì´ë€?</h2>
                <p>
                    'ë‚´ ë“±ê¸‰ ë¶„ì„'ì€ ë™ì„ì°¨ ê·œì •ì„ ë°˜ì˜í•˜ì—¬ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
                    ë“±ê¸‰ì€ ë™ì„ì°¨ ê·¸ë£¹ì˜ **'ê°€ì¥ ë§ˆì§€ë§‰ ë“±ìˆ˜'**ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚°ì •ë©ë‹ˆë‹¤.
                </p>
                <p>
                    <b>ì˜ˆì‹œ (9ë“±ê¸‰ì œ, 4% ì»·):</b> 100ëª… ì¤‘ 4ë“±ê¹Œì§€ 1ë“±ê¸‰ì´ì§€ë§Œ, ë§Œì•½ 4ë“±ì´ 3ëª…(ê³µë™ 4ë“±)ì´ë¼ë©´ ì´ 3ëª…ì˜ 'ë§ˆì§€ë§‰ ë“±ìˆ˜'ëŠ” 6ë“±ì´ ë©ë‹ˆë‹¤. (4, 5, 6ë“±)
                    ì´ ê²½ìš° 6ë“±ì€ 1ë“±ê¸‰ ì»·(4ë“±)ì„ ë„˜ì—ˆìœ¼ë¯€ë¡œ, ì´ 3ëª…ì€ **ëª¨ë‘ 2ë“±ê¸‰**ì´ ë©ë‹ˆë‹¤.
                </p>
            </section>
        </main>
    </div>

    <script>
        // ë“±ê¸‰ì œë³„ ëˆ„ì  ë¹„ìœ¨ ë° ê°œë³„ ë¹„ìœ¨ ì •ì˜
        const GRADE_SYSTEMS = {
            '5': {
                name: "5ë“±ê¸‰ì œ (ë‚´ì‹ )",
                labels: ['1ë“±ê¸‰', '2ë“±ê¸‰', '3ë“±ê¸‰', '4ë“±ê¸‰', '5ë“±ê¸‰'],
                ratios: [0.10, 0.24, 0.32, 0.24, 0.10],
                cumulative: [0.10, 0.34, 0.66, 0.90, 1.00]
            },
            '9': {
                name: "9ë“±ê¸‰ì œ (ìˆ˜ëŠ¥)",
                labels: ['1ë“±ê¸‰', '2ë“±ê¸‰', '3ë“±ê¸‰', '4ë“±ê¸‰', '5ë“±ê¸‰', '6ë“±ê¸‰', '7ë“±ê¸‰', '8ë“±ê¸‰', '9ë“±ê¸‰'],
                ratios: [0.04, 0.07, 0.12, 0.17, 0.20, 0.17, 0.12, 0.07, 0.04],
                cumulative: [0.04, 0.11, 0.23, 0.40, 0.60, 0.77, 0.89, 0.96, 1.00]
            }
        };

        let gradeChartInstance; // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤
        let lastCalculatedData = null; // ë§ˆì§€ë§‰ ê³„ì‚° ê²°ê³¼ë¥¼ ì €ì¥í•  ë³€ìˆ˜

        // ê³„ì‚°í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('calculate-btn').addEventListener('click', function() {
            // --- 1. ì…ë ¥ ê°’ ê°€ì ¸ì˜¤ê¸° ---
            const totalStudents = parseInt(document.getElementById('total-students').value);
            const selectedGradeType = document.querySelector('input[name="grade-type"]:checked').value;
            // ë‚´ ë“±ê¸‰ ì…ë ¥ê°’
            const myRank = parseInt(document.getElementById('my-rank').value);
            const myTies = parseInt(document.getElementById('my-ties').value) || 1;

            // --- 2. ìœ íš¨ì„± ê²€ì‚¬ (ì „ì²´ ì¸ì›) ---
            if (isNaN(totalStudents) || totalStudents <= 0) {
                alert("ì „ì²´ ì¸ì›ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            const system = GRADE_SYSTEMS[selectedGradeType];
            
            // --- 3. ë‚´ ë“±ê¸‰ ë¶„ì„ (ì…ë ¥ëœ ê²½ìš°ì—ë§Œ) ---
            if (!isNaN(myRank) && myRank > 0) {
                if(myRank > totalStudents || (myRank + myTies - 1) > totalStudents) {
                    alert("ë³¸ì¸ ë“±ìˆ˜ ë˜ëŠ” ë™ì„ì°¨ ì¸ì›ì´ ì „ì²´ ì¸ì›ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }

                const finalRank = myRank + myTies - 1; // ë™ì„ì°¨ ë°˜ì˜ ìµœì¢… ë“±ìˆ˜
                
                // ë“±ê¸‰ ì»· ë“±ìˆ˜ ë°°ì—´ ìƒì„±
                const cutoffs = system.cumulative.map(p => Math.round(totalStudents * p));

                // ë‚´ ë“±ê¸‰ ì°¾ê¸°
                const currentGrade = findMyGrade(finalRank, cutoffs);
                
                // ë¶„ì„ í…ìŠ¤íŠ¸ ìƒì„±
                const analysisHtml = generateGradeAnalysis(myRank, finalRank, currentGrade, cutoffs, system.labels.length);

                // ê²°ê³¼ í‘œì‹œ
                document.getElementById('my-grade-title').textContent = `â­ ë‚˜ì˜ ${system.name} ë¶„ì„`;
                document.getElementById('my-grade-display').textContent = `${currentGrade}ë“±ê¸‰`;
                document.getElementById('my-grade-analysis').innerHTML = analysisHtml;
                document.getElementById('my-grade-section').style.display = 'block';

            } else {
                // ë‚´ ë“±ê¸‰ ì…ë ¥ ì•ˆí–ˆìœ¼ë©´ ìˆ¨ê¹€
                document.getElementById('my-grade-section').style.display = 'none';
            }


            // --- 4. ì „ì²´ ë“±ê¸‰ ë¶„í¬ ê³„ì‚° ---
            const calculatedStudents = [];
            let lastCumulativeCount = 0;

            system.cumulative.forEach(cumPercent => {
                const cumulativeCount = Math.round(totalStudents * cumPercent);
                const gradeStudents = cumulativeCount - lastCumulativeCount;
                calculatedStudents.push(gradeStudents);
                lastCumulativeCount = cumulativeCount;
            });
            
            // 5. ì „ì²´ ë¶„í¬ ê²°ê³¼ í‘œì‹œ
            document.getElementById('results-section').style.display = 'block';
            document.getElementById('copy-btn').style.display = 'block'; // ë³µì‚¬ ë²„íŠ¼ ë³´ì´ê¸°
            document.getElementById('results-title').textContent = `ğŸ“Š ${system.name} ì „ì²´ ë¶„í¬ (ì´ ${totalStudents}ëª…)`;
            
            // 6. í…Œì´ë¸” ìƒì„±
            generateTableHTML(system.labels, system.ratios, calculatedStudents);

            // 7. ì°¨íŠ¸ ìƒì„±
            drawChart(system.labels, calculatedStudents);

            // 8. ë³µì‚¬ë¥¼ ìœ„í•´ ë°ì´í„° ì €ì¥
            lastCalculatedData = {
                labels: system.labels,
                ratios: system.ratios,
                students: calculatedStudents
            };
        });

        // --- Helper í•¨ìˆ˜ë“¤ (ë³€ê²½ ì—†ìŒ) ---

        /**
         * ìµœì¢… ë“±ìˆ˜(finalRank)ê°€ ëª‡ ë“±ê¸‰ì— í•´ë‹¹í•˜ëŠ”ì§€ ì°¾ìŠµë‹ˆë‹¤.
         */
        function findMyGrade(finalRank, cutoffs) {
            for (let i = 0; i < cutoffs.length; i++) {
                if (finalRank <= cutoffs[i]) {
                    return i + 1; // 1ë“±ê¸‰ë¶€í„° ì‹œì‘
                }
            }
            return cutoffs.length; // ë§ˆì§€ë§‰ ë“±ê¸‰
        }

        /**
         * ìš”ì²­í•˜ì‹  ë¶„ì„ ë©˜íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function generateGradeAnalysis(myRank, finalRank, currentGrade, cutoffs, maxGrade) {
            let html = "";
            
            // 1. ìƒìœ„ ë“±ê¸‰ ë¶„ì„
            if (currentGrade > 1) {
                const upperGradeCutoff = cutoffs[currentGrade - 2]; // ìƒìœ„ ë“±ê¸‰ ì»·
                const peopleToPass = myRank - upperGradeCutoff; // ë‚´ê°€ ì œì³ì•¼ í•  ì‚¬ëŒ ìˆ˜
                
                if (peopleToPass <= 0) {
                    html += `<p>â„¹ï¸ ë³¸ì¸ ë“±ìˆ˜(${myRank}ë“±)ëŠ” ${currentGrade - 1}ë“±ê¸‰ ì»·(${upperGradeCutoff}ë“±) ì•ˆì´ì§€ë§Œ,
                             <strong>ë™ì„ì°¨(ìµœì¢… ${finalRank}ë“±)</strong>ë¡œ ì¸í•´ ${currentGrade}ë“±ê¸‰ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>`;
                } else {
                    html += `<p><b>[â¬†ï¸ ìƒìœ„]</b> <strong>${peopleToPass}ëª…</strong>ë§Œ ì œì¹˜ë©´ ${currentGrade - 1}ë“±ê¸‰(ì»· ${upperGradeCutoff}ë“±)ì…ë‹ˆë‹¤!</p>`;
                }
            } else {
                html += "<p><b>[â¬†ï¸ ìƒìœ„]</b> ìµœê³  ë“±ê¸‰ì¸ <b>1ë“±ê¸‰</b>ì…ë‹ˆë‹¤. ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰</p>";
            }

            // 2. í•˜ìœ„ ë“±ê¸‰ ë¶„ì„
            if (currentGrade < maxGrade) {
                const currentGradeCutoff = cutoffs[currentGrade - 1]; // í˜„ì¬ ë“±ê¸‰ ì»·
                const ranksToDrop = (currentGradeCutoff - finalRank) + 1; // 1ë“±ë§Œ ì³ì ¸ë„ ë–¨ì–´ì§€ëŠ” ê²½ìš°
                
                if (ranksToDrop === 1) {
                    html += `<p><b>[â¬‡ï¸ í•˜ìœ„]</b> <strong>1ë“±</strong>ë§Œ ì³ì ¸ë„ (ì¦‰, ${currentGradeCutoff + 1}ë“±ì´ ë˜ë©´) ${currentGrade + 1}ë“±ê¸‰ìœ¼ë¡œ ë–¨ì–´ì§‘ë‹ˆë‹¤. ğŸ˜¥</p>`;
                } else {
                    html += `<p><b>[â¬‡ï¸ í•˜ìœ„]</b> <strong>${ranksToDrop}ë“±</strong> ì³ì§€ë©´ (ì¦‰, ${currentGradeCutoff + 1}ë“±ì´ ë˜ë©´) ${currentGrade + 1}ë“±ê¸‰ìœ¼ë¡œ ë–¨ì–´ì§‘ë‹ˆë‹¤.</p>`;
                }
            } else {
                html += `<p><b>[â¬‡ï¸ í•˜ìœ„]</b> ë§ˆì§€ë§‰ ë“±ê¸‰ì…ë‹ˆë‹¤.</p>`;
            }
            
            return html;
        }


        // í´ë¦½ë³´ë“œ ë³µì‚¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById('copy-btn').addEventListener('click', function() {
            if (!lastCalculatedData) return;

            // TSV (Tab-Separated Value) ë¬¸ìì—´ ìƒì„± (ì‹œíŠ¸ ë¶™ì—¬ë„£ê¸°ìš©)
            let tsvString = "ë“±ê¸‰\të¹„ìœ¨\tê³„ì‚°ëœ ì¸ì›\n"; // í—¤ë”
            
            for (let i = 0; i < lastCalculatedData.labels.length; i++) {
                const label = lastCalculatedData.labels[i];
                const ratio = (lastCalculatedData.ratios[i] * 100).toFixed(0) + "%";
                const count = lastCalculatedData.students[i] + "ëª…";
                tsvString += `${label}\t${ratio}\t${count}\n`;
            }

            // Clipboard APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë³µì‚¬
            navigator.clipboard.writeText(tsvString).then(() => {
                alert('ì „ì²´ ë¶„í¬ ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nêµ¬ê¸€ ì‹œíŠ¸ì— ë°”ë¡œ ë¶™ì—¬ë„£ê¸° (Ctrl+V) í•˜ì„¸ìš”!');
            }).catch(err => {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        });

        /**
         * ë“±ê¸‰ë³„ ì¸ì› í…Œì´ë¸” HTMLì„ ìƒì„±í•˜ê³  ì‚½ì…í•©ë‹ˆë‹¤.
         */
        function generateTableHTML(labels, ratios, students) {
            let html = '<table>';
            html += '<tr><th>ë“±ê¸‰</th><th>ë¹„ìœ¨</th><th>ê³„ì‚°ëœ ì¸ì›</th></tr>';

            for (let i = 0; i < labels.length; i++) {
                html += `<tr>
                            <td><b>${labels[i]}</b></td>
                            <td>${(ratios[i] * 100).toFixed(0)}%</td>
                            <td>${students[i]}ëª…</td>
                         </tr>`;
            }
            html += '</table>';
            
            document.getElementById('grade-table-container').innerHTML = html;
        }

        /**
         * ë“±ê¸‰ë³„ ì¸ì› Bar ì°¨íŠ¸ë¥¼ ê·¸ë¦½ë‹ˆë‹¤.
         */
        function drawChart(labels, students) {
            const ctx = document.getElementById('gradeChart').getContext('2d');

            if (gradeChartInstance) {
                gradeChartInstance.destroy(); // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ íŒŒê´´
            }

            gradeChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë“±ê¸‰ë³„ ì¸ì› (ëª…)',
                        data: students,
                        backgroundColor: [
                            'rgba(231, 76, 60, 0.7)',  // 1ë“±ê¸‰ (ê°•ì¡°)
                            'rgba(241, 196, 15, 0.7)', // 2ë“±ê¸‰
                            'rgba(46, 204, 113, 0.7)', // 3ë“±ê¸‰
                            'rgba(52, 152, 219, 0.7)', // 4ë“±ê¸‰
                            'rgba(155, 89, 182, 0.7)', // 5ë“±ê¸‰
                            'rgba(52, 73, 94, 0.7)',  // 6ë“±ê¸‰
                            'rgba(127, 140, 141, 0.7)',// 7ë“±ê¸‰
                            'rgba(211, 84, 0, 0.7)',  // 8ë“±ê¸‰
                            'rgba(192, 57, 43, 0.7)'  // 9ë“±ê¸‰
                        ],
                        borderColor: '#fff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // ë²”ë¡€ ìˆ¨ê¸°ê¸°
                        },
                        title: {
                            display: true,
                            text: 'ë“±ê¸‰ë³„ ì¸ì› ë¶„í¬',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ì¸ì› (ëª…)'
                            }
                        },
                        x: {
                            grid: {
                                display: false // xì¶• ê·¸ë¦¬ë“œ ìˆ¨ê¸°ê¸°
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
